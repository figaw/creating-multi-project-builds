<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Creating Multi-project Builds</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<link rel="stylesheet" href="https://guides.gradle.org/asciidoctor.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700|Source+Code+Pro:500">
<link rel="apple-touch-icon" sizes="180x180" href="https://guides.gradle.org/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://guides.gradle.org/icon/manifest.json">
<link rel="mask-icon" href="https://guides.gradle.org/icon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://guides.gradle.org/icon/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Creating Multi-project Builds">
<meta name="application-name" content="Creating Multi-project Builds">
<meta name="msapplication-config" content="https://guides.gradle.org/icon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<script>
  (function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,"script","https://www.google-analytics.com/analytics.js","ga");
  ga("create", "UA-4207603-1", "auto");
  ga("send", "pageview");
</script>
</head>
<body class="article toc2 toc-right">
<div id="header"><div style="padding-top: 10px;"><a href="https://guides.gradle.org"><img src="http://guides.gradle.org/gradle-guides.svg" alt=""></a></div><h1>Creating Multi-project Builds</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#what_you_ll_build">What you&#8217;ll build</a></li>
<li><a href="#what_you_ll_need">What you&#8217;ll need</a></li>
<li><a href="#create_a_root_project">Create a root project</a></li>
<li><a href="#configure_from_above">Configure from above</a></li>
<li><a href="#add_a_groovy_library_subproject">Add a Groovy library subproject</a></li>
<li><a href="#add_a_java_application_subproject">Add a Java application subproject</a></li>
<li><a href="#add_documentation">Add documentation</a></li>
<li><a href="#include_documentation_in_distribution">Include documentation in distribution</a></li>
<li><a href="#refactor_common_build_script_code">Refactor common build script code</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#next_steps">Next Steps</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Multi-project builds helps with modularisation,
it also allows a person to concentrate on one area of work in larger project, whilst Gradle can take care of rebuilding dependencies from other parts of the project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_you_ll_build"><a class="anchor" href="#what_you_ll_build"></a>What you&#8217;ll build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You&#8217;ll build a greeting app which also includes documentation. In the process you will create a Groovy-based library project, an Asciidoctor-based documentation projects and a Java distributable command-line application. You will see how to connect these projects together to create a final product.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_you_ll_need"><a class="anchor" href="#what_you_ll_need"></a>What you&#8217;ll need</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>About NN minutes</p>
</li>
<li>
<p>A text editor</p>
</li>
<li>
<p>A command prompt</p>
</li>
<li>
<p>The Java Development Kit (JDK), version 1.7 or higher</p>
</li>
<li>
<p>A <a href="https://gradle.org/install">Gradle distribution</a>, version 3.5 or better</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create_a_root_project"><a class="anchor" href="#create_a_root_project"></a>Create a root project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step is to create a folder for the new project and add a <a href="https://docs.gradle.org/3.5/userguide/gradle_wrapper.html#sec:wrapper_generation">Gradle Wrapper</a> to the project. If you use the <a href="https://docs.gradle.org/3.5/userguide/build_init_plugin.html">Build Init plugin</a> then the necessary <code>settings.gradle</code> and <code>build.gradle</code> will also be added.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir creating-multi-project-builds
$ cd creating-multi-project-builds
$ gradle init <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>

:wrapper
:init

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use of <code>init</code> will create skeleton <code>build.gradle</code> and <code>settings.gradle</code> files which can be customised.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This also allows a version of Gradle to be locked to a project and henceforth you can use <code>./gradlew</code> (or <code>gradlew.bat</code> on Windows) instead of <code>gradle</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Open <code>settings.gradle</code>. There will be a number of comments in there, which you can remove, leaving on this important line:</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">creating-multi-project-builds</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Great! You are now ready to start development. (Remember to save your file).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure_from_above"><a class="anchor" href="#configure_from_above"></a>Configure from above</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a multi-project you can use the top-level build file (also known as the root project) to configure as much commonality as possible, leaving subprojects to only customise that which is necessary for the scope of that subproject.</p>
</div>
<div class="paragraph">
<p>When using the <code>init</code> task with no parameters, Gradle generates a <code>build.gradle</code> file with a basic Java layout in a comment block. Open <code>build.gradle</code>, remove everything and replace it with</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    repositories {
        jcenter() <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the JCenter repository to all projects.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>allprojects</code> block is used to add configuration items that will apply to all subprojects as well as the root project. In a similar fashion, the <code>subprojects</code> block can be used  to add configurations items for all subprojects, but not the root project. You can use these two blocks as many times as you want in the root project.</p>
</div>
<div class="paragraph">
<p>Now set the version for each of the modules which you will be adding, via the <code>subproject</code> block as follows</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">subprojects {
    version = <span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add_a_groovy_library_subproject"><a class="anchor" href="#add_a_groovy_library_subproject"></a>Add a Groovy library subproject</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create the directory for your library subproject.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir greeting-library</pre>
</div>
</div>
<div class="paragraph">
<p>Create a <code>build.gradle</code> and add the basic Groovy library project content. (If you have never built a Groovy library with Gradle before, you might want to look at the Getting Started Guide for <a href="https://guides.gradle.org/building-groovy-libraries">Building Groovy Libraries</a>.</p>
</div>
<div class="listingblock">
<div class="title">greeting-library/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply plugin : <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>

dependencies {
    compile <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy:2.4.10</span><span class="delimiter">'</span></span>

    testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.0-groovy-2.4</span><span class="delimiter">'</span></span>, {
        exclude module : <span class="string"><span class="delimiter">'</span><span class="content">groovy-all</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now edit <code>settings.gradle</code> to make this part of the multi-project build.</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">greeting-library</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, create the <code>src/main/groovy</code> folder under <code>greeting-library and add the package folder `greeter</code>, to which you which you add a class source file callefd <code>GreetingFormatter</code>.</p>
</div>
<div class="listingblock">
<div class="title">greeting-library/src/main/groovy/greeter/GreetingFormatter.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> greeter

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">GreetingFormatter</span> {
    <span class="directive">static</span> <span class="predefined-type">String</span> greeting(<span class="directive">final</span> <span class="predefined-type">String</span> name) {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="inline"><span class="inline-delimiter">${</span>name.capitalize()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a Spock Framework test</p>
</div>
<div class="listingblock">
<div class="title">greeting-library/src/test/groovy/greeter/GreetingFormatterSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> greeter

<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">GreetingFormatterSpec</span> <span class="directive">extends</span> Specification {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">Creating a greeting</span><span class="delimiter">'</span></span>() {

        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">The greeeting to be correctly capitalized</span><span class="delimiter">'</span></span>
        GreetingFormatter.greeting(<span class="string"><span class="delimiter">'</span><span class="content">gradlephant</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">Hello, Gradlephant</span><span class="delimiter">'</span></span>

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>./gradlew build</code> from the top.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew build

:greeting-library:compileJava NO-SOURCE
:greeting-library:compileGroovy
:greeting-library:processResources NO-SOURCE
:greeting-library:classes
:greeting-library:jar
:greeting-library:assemble
:greeting-library:compileTestJava NO-SOURCE
:greeting-library:compileTestGroovy
:greeting-library:processTestResources NO-SOURCE
:greeting-library:testClasses
:greeting-library:test
:greeting-library:check
:greeting-library:build

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle automatically detected that there is a <code>build</code> task in <code>greeting-library</code> and executed it. This is one of the powerful features of a Gradle multi-project. When tasks and subprojects have the same names by convention, then maintenance of the build will be easier and it is also to execute the same tasks in each project by just specifying it from the top.</p>
</div>
<div class="paragraph">
<p>A single subproject does not truly make a multi-project, therefore the next step is to add a subproject which can consume this library,</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add_a_java_application_subproject"><a class="anchor" href="#add_a_java_application_subproject"></a>Add a Java application subproject</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a folder for the subproject which will contain the distributable application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir greeter</pre>
</div>
</div>
<div class="listingblock">
<div class="title">greeter/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply plugin : <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
apply plugin : <span class="string"><span class="delimiter">'</span><span class="content">application</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the Java project, therefore the <a href="https://docs.gradle.org/3.5/userguide/java_plugin.html">Java plugin</a> is required.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the <a href="https://docs.gradle.org/3.5/userguide/application_plugin.html">Application plugin</a> to make this a distributable application.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/3.5/userguide/application_plugin.html">Application plugin</a> allows you to bundle all of your applications JARs as well as all of their transitive dependencies into a single ZIP or TAR file. It will also add two startup scripts (one for UNIX-like operations systems and one for Windows) to the archive to make it easy for your users to run your application.</p>
</div>
<div class="paragraph">
<p>Once again, update <code>settings.gradle</code> to add the new project</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">greeter</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now create a Java class file with a main function, which will consume the <code>Greeter</code> library from the <code>greeting-library</code> subproject.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir -p greeter/src/main/java/greeter</pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/greeter/Greeter.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">greeter</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Greeter</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        <span class="directive">final</span> <span class="predefined-type">String</span> output = GreetingFormatter.greeting(args[<span class="integer">0</span>]);
        <span class="predefined-type">System</span>.out.println(output);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the target is a distributable application, you also need to tell Gradle the name of the class which is the entry point to running the application. Edit the <code>build.gradle</code> file again and add</p>
</div>
<div class="listingblock">
<div class="title">greeter/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">mainClassName = <span class="string"><span class="delimiter">'</span><span class="content">greeter.Greeter</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>mainClassName</code> to set the entry point class. (This expects a class with a class emthod called <code>main</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the build which will fail.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew build

...
.../Greeter.java:5: error: cannot find symbol
        final String output = GreetingFormatter.greeting(args[0]);
                              ^
  symbol:   variable GreetingFormatter
  location: class Greeter
1 error

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':greeter:compileJava'.
&gt; Compilation failed; see the compiler error output for details.

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</pre>
</div>
</div>
<div class="paragraph">
<p>This is because the <code>greeter</code> project does not know where to find the <code>greeting-library</code>. Creating a collecton of subprojects does not automatically make their respective artifacts automatically available to other subprojects - that would just lead to very brittle projects. Gradle has a specific syntax to link the artifacts of one subproject to the dependencies of another subproject. Edit the <code>build.gradle</code> script again and add:</p>
</div>
<div class="listingblock">
<div class="title">greeter/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    compile project(<span class="string"><span class="delimiter">'</span><span class="content">:greeting-library</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the <code>project(NAME)</code> syntax to add the artifacts of one subproject to the dependencies of another subproject.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the build again, which now passes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew build

:greeting-library:compileJava NO-SOURCE
:greeting-library:compileGroovy UP-TO-DATE
:greeting-library:processResources NO-SOURCE
:greeting-library:classes UP-TO-DATE
:greeting-library:jar UP-TO-DATE
:greeter:compileJava
:greeter:compileGroovy NO-SOURCE
:greeter:processResources NO-SOURCE
:greeter:classes
:greeter:jar
:greeter:startScripts
:greeter:distTar
:greeter:distZip
:greeter:assemble
:greeter:compileTestJava NO-SOURCE
:greeter:compileTestGroovy
:greeter:processTestResources NO-SOURCE
:greeter:testClasses
:greeter:test
:greeter:check
:greeter:build
:greeting-library:assemble UP-TO-DATE
:greeting-library:compileTestJava NO-SOURCE
:greeting-library:compileTestGroovy UP-TO-DATE
:greeting-library:processTestResources NO-SOURCE
:greeting-library:testClasses UP-TO-DATE
:greeting-library:test UP-TO-DATE
:greeting-library:check UP-TO-DATE
:greeting-library:build UP-TO-DATE

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>Notice how each subproject is prefixed in the output, so that you know which task from which project is executed. Also note that Gradle does not process all tasks from one subproject, before moving onto another. It has processed enough tasks from <code>greeting-library</code> to be able to fulfill the project dependency needs of <code>greeter</code>.</p>
</div>
<div class="paragraph">
<p>Add a test to ensure your code in the application itself works. As Spock Framework is a popular approach to testing Java code as well, create the test by adding the <a href="https://docs.gradle.org/3.5/userguide/groovy_plugin.html">Groovy plugin</a> to the <code>build.gradle</code> script.</p>
</div>
<div class="listingblock">
<div class="title">greeter/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply plugin : <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>

dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.0-groovy-2.4</span><span class="delimiter">'</span></span>, {
        exclude module : <span class="string"><span class="delimiter">'</span><span class="content">groovy-all</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add the test itself to the subproject.</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/greeter/GreeterSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">greeter</span>

<span class="namespace">import</span> <span class="namespace">spock.lang.Specification</span>

<span class="namespace">class</span> <span class="namespace">GreeterSpec</span> <span class="namespace">extends</span> <span class="namespace">Specification</span> {

    <span class="namespace">def</span> <span class="string"><span class="delimiter">'</span><span class="content">Calling the entry point</span><span class="delimiter">'</span></span>() {

        <span class="namespace">setup</span>: <span class="string"><span class="delimiter">'</span><span class="content">Re-route standard out</span><span class="delimiter">'</span></span>
        <span class="namespace">def</span> <span class="namespace">buf</span> = <span class="namespace">new</span> <span class="namespace">ByteArrayOutputStream</span>(<span class="integer">1024</span>)
        <span class="namespace">System.out</span> = <span class="namespace">new</span> <span class="namespace">PrintStream</span>(<span class="namespace">buf</span>)

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">The entrypoint is executed</span><span class="delimiter">'</span></span>
        <span class="namespace">Greeter.main</span>(<span class="string"><span class="delimiter">'</span><span class="content">gradlephant</span><span class="delimiter">'</span></span>)

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">The correct greeting is output</span><span class="delimiter">'</span></span>
        <span class="namespace">buf.toString</span>() == <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, Gradlephant</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of running the complete build again, just run the test inside the <code>greeter</code> subproject.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew :greeter:test

:greeting-library:compileJava NO-SOURCE
:greeting-library:compileGroovy UP-TO-DATE
:greeting-library:processResources NO-SOURCE
:greeting-library:classes UP-TO-DATE
:greeting-library:jar UP-TO-DATE
:greeter:compileJava UP-TO-DATE
:greeter:compileGroovy NO-SOURCE
:greeter:processResources NO-SOURCE
:greeter:classes UP-TO-DATE
:greeter:compileTestJava NO-SOURCE
:greeter:compileTestGroovy UP-TO-DATE
:greeter:processTestResources NO-SOURCE
:greeter:testClasses UP-TO-DATE
:greeter:test UP-TO-DATE

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to run any task in any subproject from the top (or any other subproject), by using the format <code>:SUBPROJECT:TASK</code> as the task name. This removes the need to have done the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cd greeter
../gradlew test <i class="conum" data-value="1"></i><b>(1)</b>
cd ..</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Due to changing one directory down, you will need to add <code>..</code> in order to get to the Gradle Wrapper.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you were to spend a lot of time working in one subproject, changing to that directory and running the build from there could be a time-saving. However, if you need to quickly run a task in a specific subproject, having the flexibility to specify the task by subproject path is a great time-saver in itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Have you noticed that the last task executed was <code>:greeter:test</code>, but that Gradle first visited <code>greeting-library</code> to ensure that the dependencies were up to date. This is one more example how the powerful task graph implementation in Gradle saves you time.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add_documentation"><a class="anchor" href="#add_documentation"></a>Add documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is considered good practice to create documentation for a software project. Although there a number of authoring methods to accomplish this goal, you will be using the very popular <a href="http://asciidoctor.org/">Asciidoctor</a> tool.</p>
</div>
<div class="paragraph">
<p>Start by adding the <a href="https://plugins.gradle.org/plugin/org.asciidoctor.convert">Asciidoctor plugin</a> to the <a href="https://docs.gradle.org/3.5/userguide/plugins.html#sec:plugins_block">plugins block</a> in the root project.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
  id <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor.convert</span><span class="delimiter">'</span></span> version <span class="string"><span class="delimiter">'</span><span class="content">1.5.3</span><span class="delimiter">'</span></span> apply <span class="predefined-constant">false</span> <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The use of <code>apply false</code> adds the plugin to the overall project, but does not add it to the root project.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now another subproject folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir docs</pre>
</div>
</div>
<div class="paragraph">
<p>Create a <code>build.gradle</code> file this folder with the following content</p>
</div>
<div class="listingblock">
<div class="title">docs/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply plugin : <span class="string"><span class="delimiter">'</span><span class="content">org.asciidoctor.convert</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>

asciidoctor {
    sources {
        include <span class="string"><span class="delimiter">'</span><span class="content">greeter.adoc</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

build.dependsOn <span class="string"><span class="delimiter">'</span><span class="content">asciidoctor</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply the Asciidoctor plugin this subproject. This is the technique to use to selectively apply plugins to subprojects, but define all of the plugins in the rootproject.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Tells the plugin to look for a document called <code>greeter.adoc</code> in the default source folder <code>src/docs/asciidoc</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adds <code>asciidoctor</code> task into the build lifecycle so that if <code>build</code> is executed fror the top, then documentation will be built as well.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add this subproject to <code>settings.gradle</code>.</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">docs</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add a document in the default Asciidoctor source folder.</p>
</div>
<div class="literalblock">
<div class="title">docs/src/docs/asciidoc/greeter.adoc</div>
<div class="content">
<pre>= Greeter Command-line Application

A simple application demonstrating the flexibility of a Gradle multi-project.

== Installation

Unpack the ZIP or TAR file in a suitable location

== Usage

[listing]
----
$ cd greeter-1.0
$ ./bin/greeter gradlephant

Hello, Gradlephant
----</pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>asciidoctor</code> task from the command-line</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew asciidoctor

:docs:asciidoctor

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Did you notice that Gradle knew to only run this task in the <code>docs</code> subproject? This is because when you run a task from the level of a root project and this task does not exist in the root, then Gradle will run the task in each of the subprojects where a task by that name exists.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The documentation artifact will appear in <code>docs/build/asciidoc/html</code>. Feel free to open the the <code>greeter.html</code> file and inspect the output.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="include_documentation_in_distribution"><a class="anchor" href="#include_documentation_in_distribution"></a>Include documentation in distribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documentation is useful when published, but usage documentation distributed with an application is very valuable for people trying out your application. Add this generated documentation to your distribution by updating task dependencies in <code>greeter</code>.</p>
</div>
<div class="listingblock groovy">
<div class="title">greeter/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code>distZip {
    from project(':docs').asciidoctor, { <i class="conum" data-value="1"></i><b>(1)</b>
        into "${project.name}-${version}"
    }
}
distTar {
    from project(':docs').asciidoctor, {
        into "${project.name}-${version}"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>project(NAME).TASKNAME</code> format to reference a task instance in another project.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Build from the top again</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew build

:docs:asciidoctor UP-TO-DATE
:docs:assemble UP-TO-DATE
:docs:check UP-TO-DATE
:docs:build UP-TO-DATE
:greeting-library:compileJava NO-SOURCE
:greeting-library:compileGroovy UP-TO-DATE
:greeting-library:processResources NO-SOURCE
:greeting-library:classes UP-TO-DATE
:greeting-library:jar UP-TO-DATE
:greeter:compileJava UP-TO-DATE
:greeter:compileGroovy NO-SOURCE
:greeter:processResources NO-SOURCE
:greeter:classes UP-TO-DATE
:greeter:jar UP-TO-DATE
:greeter:startScripts UP-TO-DATE
:greeter:distTar
:greeter:distZip
:greeter:assemble
:greeter:compileTestJava NO-SOURCE
:greeter:compileTestGroovy UP-TO-DATE
:greeter:processTestResources NO-SOURCE
:greeter:testClasses UP-TO-DATE
:greeter:test UP-TO-DATE
:greeter:check UP-TO-DATE
:greeter:build
:greeting-library:assemble UP-TO-DATE
:greeting-library:compileTestJava NO-SOURCE
:greeting-library:compileTestGroovy UP-TO-DATE
:greeting-library:processTestResources NO-SOURCE
:greeting-library:testClasses UP-TO-DATE
:greeting-library:test UP-TO-DATE
:greeting-library:check UP-TO-DATE
:greeting-library:build UP-TO-DATE

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>Notice how most tasks are still up to date, but <code>distZip</code> and <code>distTar</code> has been re-run to include the documentation. If you unpack one of the archives (<code>zip</code> or <code>tar</code>) in <code>build/distributions</code> you will see the documentation included in the <code>html5</code> folder.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="refactor_common_build_script_code"><a class="anchor" href="#refactor_common_build_script_code"></a>Refactor common build script code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point you might have noticed that you have common script code in both <code>greeting-plugin/build.gradle</code> and <code>greeter.build.gradle</code>. A key feature of Gradle is the ability to place such common build script code in the root project.</p>
</div>
<div class="paragraph">
<p>Edit <code>build.gradle</code> in the root project and add the following code</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configure(subprojects.findAll {<span class="local-variable">it</span>.name == <span class="string"><span class="delimiter">'</span><span class="content">greeter</span><span class="delimiter">'</span></span> || <span class="local-variable">it</span>.name == <span class="string"><span class="delimiter">'</span><span class="content">greeting-library</span><span class="delimiter">'</span></span>} ) { <i class="conum" data-value="1"></i><b>(1)</b>

    apply plugin : <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>

    dependencies {
        testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.0-groovy-2.4</span><span class="delimiter">'</span></span>, {
            exclude module : <span class="string"><span class="delimiter">'</span><span class="content">groovy-all</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use of <code>configure</code> along with a predicate closure allows for selective subprojects to be configures. The predicate closure is passed a subproject which can be queried. In this case only subprojects with specific name matches will be configured.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the same time remove the following lines from <code>greeting-plugin/build.gradle</code></p>
</div>
<div class="listingblock groovy">
<div class="title">greeting-plugin/build.gradle (Removed code)</div>
<div class="content">
<pre class="CodeRay highlight"><code>apply plugin : 'groovy'

dependencies {
    testCompile 'org.spockframework:spock-core:1.0-groovy-2.4', {
        exclude module : 'groovy-all'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>also remove similar lines from <code>greeter/build.gradle</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By following the steps you have seen how to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a modular software project by combining multiple subprojects.</p>
</li>
<li>
<p>Have one subproject consume artifacts from another subproject.</p>
</li>
<li>
<p>Have a polyglot project with ease.</p>
</li>
<li>
<p>Run similar named tasks in all subprojects.</p>
</li>
<li>
<p>Run tasks in specific subprojects without changing to the subproject&#8217;s folder.</p>
</li>
<li>
<p>Refactor common subproject settings into the root project.</p>
</li>
<li>
<p>Selectively configure subprojects from the rootproject.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next_steps"><a class="anchor" href="#next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Remembering to type <code>./gradlew</code>, <code>../gradlew</code> or even <code>../../gradlew</code> can become an arduous task. If you are on a Uxix-like operating system consider installing <a href="https://github.com/dougborg/gdub">gdub</a>.</p>
</li>
<li>
<p>Read about multi-project in the <a href="https://docs.gradle.org/3.5/userguide/multi_project_builds.html">User Manual</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-06 11:56:53 UTC
</div>
</div>
</body>
</html>